function interaction(){$("#map").on("shown",function(){google.maps.event.trigger(map,"resize")}),bindInteraction("#top > h1",main),bindInteraction("#top > span",help),bindInteraction("#manual",help),bindInteraction("#set",setLocation),bindInteraction("#auto",getLocation),bindInteraction("#setLocation",addLocation),bindInteraction("#show",showLocations),bindInteraction("#car",addCar),bindInteraction("#home",addHome),bindInteraction("#bike",addBike),bindInteraction("#route",routes),bindInteraction("form",formClick),bindInteraction("#text",textDescr),bindInteraction("#del",delLoc),bindInteraction("#instructions",showInstructions),$("#graph2").on("shown",function(){google.maps.event.trigger(map,"resize")})}function showInstructions(){$("#content").css("overflow-y","scroll"),switchScreen("#instr")}function bindInteraction(o,t){$(o).bind("touchEvent",function(o){t(o)}),$(o).click(function(o){t(o)})}function formClick(o){$(this).data("clicked",$(o.target))}function help(){$("#error > h2").text("This functionality is not yet implemented."),switchScreen("#error")}function main(){switchScreen("#main"),$("#content").css("overflow-y","hidden")}function textDescr(){$("#graph2").empty(),0==text?($("#map2 #text").text("Show Map"),directionsDisplay.setPanel(document.getElementById("graph2")),text=!0):($("#map #text").text("Show Text Description"),directionsDisplay.setMap(map),text=!1)}function initialize(){$("#graph2").empty(),directionsDisplay=new google.maps.DirectionsRenderer;var o={zoom:10,center:currentPos,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1};map=new google.maps.Map(document.getElementById("graph2"),o),directionsDisplay.setMap(map);new google.maps.Marker({position:currentPos,map:map,title:"My location"})}function calculateRoute(o){text=!1;var t=$(this).data("clicked").prev().text(),e=locations[t].pos,n={origin:currentPos,destination:e,travelMode:google.maps.DirectionsTravelMode.DRIVING};directionsService.route(n,function(o,t){t==google.maps.DirectionsStatus.OK?directionsDisplay.setDirections(o):alert("error")}),switchScreen("#map2")}function deleteLocation(o){var t=$(this).data("clicked").prev().text();locations.remove(t),localStorage.jsonLocations=JSON.stringify(locations),delLoc()}function setCurrentPos(o){currentPos=new google.maps.LatLng(o.coords.latitude,o.coords.longitude)}function delLoc(){printLocations("#delete")}function routes(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(setCurrentPos),printLocations("#routes")}function printLocations(o){if(locations.length>0){$(o+" ul").empty();for(var t=0;t<locations.length;++t)$(o+" ul").append('<li><span class="hidden">'+t+'</span><input type="submit" value="'+locations[t].name+'"/></li>');switchScreen(o),initialize()}else $("#error > h2").text("No location set!"),switchScreen("#error")}function addCar(){$("#locationName > input").val("MyCar"),getLocation()}function addHome(){$("#locationName > input").val("MyHome"),getLocation()}function addBike(){$("#locationName > input").val("MyBike"),getLocation()}function setLocation(){$("#locationName > input").val("MyTagName"),switchScreen("#choice")}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):($("#error > h2").text("Geolocation is not supported by this browser"),switchScreen("#error"))}function switchScreen(o){$("#content > *").css("display","none"),$(o).css("display","block")}function showPosition(o){$("#map > h2").text("Drag the cursor to your position if needed."),switchScreen("#map");var t=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),e={zoom:14,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP},n=new google.maps.Map(document.getElementById("graph"),e);marker=new google.maps.Marker({position:t,map:n,draggable:!0,title:$("#locationName > input").val(),icon:"http://bzub.heliohost.org/derby/images/mapMarker.png"})}function addLocation(){var o=new Object;o.pos=marker.getPosition(),o.name=$("#locationName > input").val(),locations.push(o),localStorage.jsonLocations=JSON.stringify(locations),alert("Location stored as: "+o.name)}function showLocations(){if(locations.length>0){$("#map3 > h2").text("Your Locations");for(var o,t={zoom:12,center:locations[0].pos,mapTypeId:google.maps.MapTypeId.ROADMAP},e=new google.maps.Map(document.getElementById("graph3"),t),n=0;n<locations.length;++n)o=new google.maps.Marker({position:locations[n].pos,map:e,title:locations[n].name,icon:"http://bzub.heliohost.org/derby/images/mapMarker.png"});google.maps.event.trigger(e,"resize"),switchScreen("#map3")}else $("#error > h2").text("No location set!"),switchScreen("#error")}$(document).ready(function(){if(locations=new Array,localStorage.jsonLocations)for(var o=JSON.parse(localStorage.jsonLocations),t=0;t<o.length;++t){var e=new Object;e.name=o[t].name,e.pos=new google.maps.LatLng(o[t].pos.jb,o[t].pos.kb),locations.push(e)}interaction()});var text=!1,directionDisplay,directionsService=new google.maps.DirectionsService,currentPos;Array.prototype.remove=function(o,t){var e=this.slice((t||o)+1||this.length);return this.length=0>o?this.length+o:o,this.push.apply(this,e)};var marker,locations;
